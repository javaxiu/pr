(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{332:function(e,t,a){"use strict";a.r(t);var r=a(14),n=Object(r.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"双滚动条的滚动逻辑"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#双滚动条的滚动逻辑"}},[e._v("#")]),e._v(" 双滚动条的滚动逻辑")]),e._v(" "),t("blockquote",[t("p",[e._v("今日段子（改编自日常工作，请认真地对号入座）\n产品经理：我要做个手机壳颜色跟着衣服颜色变。什么？做不到？你旁边那个前端他说可以，你跟他请教一下，下班之前上线！\n旁边的前端：你可以参考一下变色龙，你把皮贴到手机壳上，技术上可以的。\n我：哈？excuse me? 你是个大聪(s)明(b)吗?\n旁边的前端告诉产品经理：我跟他说了方案了，他有点自以为是不想听而已\n产品经理：他主管在哪，我投诉一下")])]),e._v(" "),t("h2",{attrs:{id:"背景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[e._v("#")]),e._v(" 背景")]),e._v(" "),t("p",[e._v("先看类似这样一个页面 "),t("a",{attrs:{href:"https://lightrun.com/answers/cardano-foundation-developer-portal-nodejs-and-yarn-version-",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://lightrun.com/answers/cardano-foundation-developer-portal-nodejs-and-yarn-version-"),t("OutboundLink")],1),e._v("，内容不重要，就中间的那个带滚动条的区域（没出现滚动的把窗口宽度拉小一点）\n"),t("img",{attrs:{src:"/pr//yuque/0/2023/png/139763/1694594439097-ef9e678e-79d5-4755-a2ff-d922557b616e.png",alt:"image.png"}}),e._v("\n如果你是用 mac 电脑的触摸板，鼠标指针悬停在滚动 div 区域，双指不要离开触摸板，一直往上推，它是不是到底了之后，整个网页不会往上滚动了？需要手指从触摸板离开一次，（鼠标指针不用换位置）再接着往上推，整个网页又可以往上滚动了")]),e._v(" "),t("p",[e._v("如果你是用鼠标（windows/mac都可以），鼠标指针悬停在 div 区域，滚动滚珠，一直滚动，它到底部之后，整个网页不会往上滚动了，需要停止滚��� 2 秒钟（鼠标指针不用移动位置，也不用做点击之类的其他操作）再接着往上滚动滚珠，整个网页又可以往上滚动了")]),e._v(" "),t("p",[e._v("产品经理认为是 bug，预期是能滚动完子区域之后接着滚动 page，不用做「离开触摸板/滚珠停止2秒」这样的操作，即可顺畅往下滑动\n（Mac人机交互设计师：来，我位置给你做）")]),e._v(" "),t("h2",{attrs:{id:"尝试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#尝试"}},[e._v("#")]),e._v(" 尝试")]),e._v(" "),t("p",[e._v("这个问题的第一反应是这个 css 配置 overscroll-behavior: contain，但是这个是表达触底之后是否触发父级，它的3个参数 auto、contain、none，显然都不能控制这一行为，最接近需求的 auto 本身就是默认值，一般页面都默认是这个，它并不管延迟的问题。\n触底之后禁止滚动、禁止鼠标事件、让元素失焦、让别的元素获得焦点，都尝试过了，不出意料都不管用。不过这步操作发现了一个意外的效果：即便代码已经给它设置为禁止滚动、无鼠标事件了，如果「未离开触摸板 or 鼠标滚珠未停下超过2秒钟」，此 div 仍然可以滚动，且能触发 wheel/scroll 事件。即便我设置了 captrue 和 passive 参数。这至少说明一个问题：滚动操作，有个截止标志。（这里推测是浏览器为了类似滚轮惯性做持续监听，所以需要个标志）\n这就能解释通了：这个截止标志，对于触摸板而言是手指头离开触模板，对于鼠标滚珠而言是你停止滚动滚珠一段时间（大概2秒）。所以这™的是系统行为，而且至少是操作系统内核级别的行为，那在浏览器里的 js 基本就无解了。\n基于这个判断，尝试了 Safari、Firefox、Edge，无一例外都是这一效果，更证实了这就是内核级 feature。好嘛，经典的 feature 当 bug 修了，而且是内核级的。\n"),t("img",{attrs:{src:"/pr//yuque/0/2023/png/139763/1694595107821-63974e95-cdad-4064-9307-e01b17564b72.png",alt:"image.png"}})]),e._v(" "),t("h2",{attrs:{id:"解决"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决"}},[e._v("#")]),e._v(" 解决")]),e._v(" "),t("p",[e._v("实在要解决，那就做点障眼法来绕开这个内核 feature 吧。能想到的解决办法就是委派事件，模拟滚动，也就是滚动到头了之后，继续把滚动事件派发到上一层滚动容器去。onscroll 到底部之后事件不会接着给回调了，那就只能用 onwheel ，做一个触底判断。代码也很简单\n"),t("img",{attrs:{src:"/pr//yuque/0/2023/png/139763/1694602661336-0377c8b2-9cac-42ab-8b40-a51b31c3a079.png",alt:"image.png"}}),e._v("\n实际操作解决了问题，但是发现两个新问题：")]),e._v(" "),t("ol",[t("li",[e._v("Mac 触模板的 deltaY 有点偏大，大概是快了3倍的样子，稍作除法即可")]),e._v(" "),t("li",[e._v("滚珠的 deltaY 大得夸张，似乎是有滚动惯性，也就是你快速滚动三五次「咔哒」声滚珠，它能给你一个 260px 的 deltaY，离谱。此处可以借助自然对数，做了一个平缓处理")])]),e._v(" "),t("p",[e._v("那么如何区分滚动行为是滚珠还是双指滚动呢？找了一下果然还是有办法 "),t("a",{attrs:{href:"https://stackoverflow.com/questions/10744645/detect-touchpad-vs-mouse-in-javascript/62415754#62415754",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://stackoverflow.com/questions/10744645/detect-touchpad-vs-mouse-in-javascript/62415754#62415754"),t("OutboundLink")],1),e._v(" "),t("img",{attrs:{src:"/pr//yuque/0/2023/png/139763/1694598244219-44498f8b-0ab7-4b20-8f3e-22dea56a6782.png",alt:"image.png"}}),t("img",{attrs:{src:"/pr//yuque/0/2023/png/139763/1694598286986-21dda197-c0e0-44ea-997d-f9ad9993ccd3.png",alt:"image.png"}})]),e._v(" "),t("p",[e._v("另外，看了一下滚珠数值离谱的问题，尝试了 mdn 上的这个 demo，看代码也是直接使用 deltaY，可以看到，如果快速「咔哒」滚动滚珠，它的矩形尺寸变化也是很离谱的 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Element/wheel_event",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://developer.mozilla.org/en-US/docs/Web/API/Element/wheel_event"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("最终代码\n"),t("img",{attrs:{src:"/pr//yuque/0/2023/png/139763/1694602977745-1d53da56-297f-4e9d-b1cf-5a9b2d4bfb4b.png",alt:"image.png"}})]),e._v(" "),t("h2",{attrs:{id:"后话"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#后话"}},[e._v("#")]),e._v(" 后话")]),e._v(" "),t("ol",[t("li",[e._v("Mac 的触模板体验确实比鼠标做得好，从开发者的角度看")]),e._v(" "),t("li",[e._v("看了看，也有人提出跟我们一样的问题, 也有人回答了，这是一个防止用户产生迷惑的 feature。"),t("a",{attrs:{href:"https://stackoverflow.com/questions/56008625/scroll-delay-between-two-divs-issue",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://stackoverflow.com/questions/56008625/scroll-delay-between-two-divs-issue"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("产品跟旁边的前端说，你看，我就说能做，他说不能，都是你指导得好，下次还要多指导一下这种低能的前端码仔。旁边的前端：好的")])])])}),[],!1,null,null,null);t.default=n.exports}}]);