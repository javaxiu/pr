<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>win7兼容性调研 | xiujava</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="jiawen 的博客">
    
    <link rel="preload" href="/assets/css/0.styles.acc2b136.css" as="style"><link rel="preload" href="/assets/js/app.ae098b94.js" as="script"><link rel="preload" href="/assets/js/2.846b7fc6.js" as="script"><link rel="preload" href="/assets/js/1.bc703a74.js" as="script"><link rel="preload" href="/assets/js/31.0442f702.js" as="script"><link rel="prefetch" href="/assets/js/10.afb24a76.js"><link rel="prefetch" href="/assets/js/11.26a4e38a.js"><link rel="prefetch" href="/assets/js/12.972428b2.js"><link rel="prefetch" href="/assets/js/13.363a2818.js"><link rel="prefetch" href="/assets/js/14.da87bb03.js"><link rel="prefetch" href="/assets/js/15.be6c279e.js"><link rel="prefetch" href="/assets/js/16.5b27973e.js"><link rel="prefetch" href="/assets/js/17.e9441626.js"><link rel="prefetch" href="/assets/js/18.73cc4e61.js"><link rel="prefetch" href="/assets/js/19.04ead57f.js"><link rel="prefetch" href="/assets/js/20.a59fc3ba.js"><link rel="prefetch" href="/assets/js/21.08fe35aa.js"><link rel="prefetch" href="/assets/js/22.827a5b12.js"><link rel="prefetch" href="/assets/js/23.4f7ffd82.js"><link rel="prefetch" href="/assets/js/24.f951cc52.js"><link rel="prefetch" href="/assets/js/25.69a8b217.js"><link rel="prefetch" href="/assets/js/26.53346931.js"><link rel="prefetch" href="/assets/js/27.7fbf6cac.js"><link rel="prefetch" href="/assets/js/28.3e339daa.js"><link rel="prefetch" href="/assets/js/29.6cf6ca93.js"><link rel="prefetch" href="/assets/js/3.7d9825a9.js"><link rel="prefetch" href="/assets/js/30.342ebd9d.js"><link rel="prefetch" href="/assets/js/32.daa02c22.js"><link rel="prefetch" href="/assets/js/33.ebf9af3c.js"><link rel="prefetch" href="/assets/js/34.bc893c08.js"><link rel="prefetch" href="/assets/js/35.70c7c053.js"><link rel="prefetch" href="/assets/js/36.246d6c9c.js"><link rel="prefetch" href="/assets/js/37.8e94202d.js"><link rel="prefetch" href="/assets/js/38.63b25286.js"><link rel="prefetch" href="/assets/js/39.f225082b.js"><link rel="prefetch" href="/assets/js/4.1b5a2940.js"><link rel="prefetch" href="/assets/js/40.4cb44a86.js"><link rel="prefetch" href="/assets/js/41.f73ad1f8.js"><link rel="prefetch" href="/assets/js/42.626a30be.js"><link rel="prefetch" href="/assets/js/43.91f67b4b.js"><link rel="prefetch" href="/assets/js/44.9eac489e.js"><link rel="prefetch" href="/assets/js/45.df9318ca.js"><link rel="prefetch" href="/assets/js/46.44570272.js"><link rel="prefetch" href="/assets/js/47.be81fd04.js"><link rel="prefetch" href="/assets/js/48.5015b80e.js"><link rel="prefetch" href="/assets/js/49.4dec6231.js"><link rel="prefetch" href="/assets/js/5.0d0d8c0c.js"><link rel="prefetch" href="/assets/js/50.ab02ecad.js"><link rel="prefetch" href="/assets/js/51.c3f45b43.js"><link rel="prefetch" href="/assets/js/52.43881e80.js"><link rel="prefetch" href="/assets/js/53.089a5dc4.js"><link rel="prefetch" href="/assets/js/54.50c11d45.js"><link rel="prefetch" href="/assets/js/55.e2c9f89d.js"><link rel="prefetch" href="/assets/js/56.f2a8cba6.js"><link rel="prefetch" href="/assets/js/57.396052cf.js"><link rel="prefetch" href="/assets/js/58.22acf40d.js"><link rel="prefetch" href="/assets/js/59.d621787d.js"><link rel="prefetch" href="/assets/js/6.ec95ead8.js"><link rel="prefetch" href="/assets/js/60.5b939ba1.js"><link rel="prefetch" href="/assets/js/7.aa392645.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5e19b665.js">
    <link rel="stylesheet" href="/assets/css/0.styles.acc2b136.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">xiujava</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://www.yuque.com/xiwen-bxuha/pr/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  yuque
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/javaxiu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://www.yuque.com/xiwen-bxuha/pr/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  yuque
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/javaxiu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NLP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Electron系列</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pr/electron/feishu.html" class="sidebar-link">飞书客户端技术</a></li><li><a href="/pr/electron/container.html" class="sidebar-link">跨端容器</a></li><li><a href="/pr/electron/electron-overview.html" class="sidebar-link">Electron 经验</a></li><li><a href="/pr/electron/win7-compatible.html" aria-current="page" class="active sidebar-link">win7兼容性调研</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pr/electron/win7-compatible.html#问题背景" class="sidebar-link">问题背景</a></li><li class="sidebar-sub-header"><a href="/pr/electron/win7-compatible.html#electron-官方说法" class="sidebar-link">Electron 官⽅说法</a></li><li class="sidebar-sub-header"><a href="/pr/electron/win7-compatible.html#vscode-运行情况" class="sidebar-link">Vscode 运⾏情况</a></li><li class="sidebar-sub-header"><a href="/pr/electron/win7-compatible.html#electron-9-2-1-在-win7-成功运行方法" class="sidebar-link">Electron 9.2.1 在 win7 成功运⾏⽅法</a></li><li class="sidebar-sub-header"><a href="/pr/electron/win7-compatible.html#⻜书-最新版-3-32-3-3-32-3-399" class="sidebar-link">⻜书(最新版 3.32.3 (3.32.3.399))</a></li><li class="sidebar-sub-header"><a href="/pr/electron/win7-compatible.html#关于-d3dcompiler-dll" class="sidebar-link">关于 d3dcompiler.dll</a></li><li class="sidebar-sub-header"><a href="/pr/electron/win7-compatible.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/pr/electron/xl1.html" class="sidebar-link">扒一扒某下载软件的源码</a></li><li><a href="/pr/electron/xl2.html" class="sidebar-link">扒一扒某下载软件的代码结构(二)</a></li><li><a href="/pr/electron/mac11.html" class="sidebar-link">Mac11.4权限问题</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>低代码系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术分享</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>杂谈</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="win7兼容性调研"><a href="#win7兼容性调研" class="header-anchor">#</a> win7兼容性调研</h1> <h2 id="问题背景"><a href="#问题背景" class="header-anchor">#</a> 问题背景</h2> <p>从 Electron6.0 开始，部分 win7 系统⽆法直接运⾏，表现为启动后界⾯⿊屏，在进程监视器中观察发 现 Electron 的⼀个 GPU render 进程持续崩溃。 ⽽ Electron⽬前最新⽀持的版本为 8.x 9.x 10.x 和 11.x-beta，官⽅只会维护更新最新三个版本+⼀ 个 beta 版本，6.x 以下的版本已经不维护，可能会出现各种安全漏洞和新 feature 兼容问题，基于它构 建的应⽤都应该需要考虑及时跟进。</p> <h2 id="electron-官方说法"><a href="#electron-官方说法" class="header-anchor">#</a> Electron 官⽅说法</h2> <p>issue 讨论区有反馈 Electron6 开始出现 win7 不兼容问题，官⽅推荐做法是安
装 .net framework 4.7.1 ，⽽ win7(⾮sp1) 不⽀持安装 4.7.1 ，最⾼⽀持 4.6.2
补充说明 .Net Framework 运⾏环境</p> <ul><li>windows 7 ⽀持的 .net framework 为 3.5 、4.0 、4.5、4.5.1、4.5.2。</li> <li>windows sp1 ⽀持 .net framework 为 4.6、4.6.2、4.7
<a href="https://support.microsoft.com/en-us/help/4019990/update-for-the-d3dcompiler-47-dllcomponent-on-windows" target="_blank" rel="noopener noreferrer">https://support.microsoft.com/en-us/help/4019990/update-for-the-d3dcompiler-47-dllcomponent-on-windows<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p><img src="/yuque/0/2021/png/139763/1637048100759-16e7559c-d89c-4b5f-a239-5862020d6c8c.png" alt="image.png"></p> <h2 id="vscode-运行情况"><a href="#vscode-运行情况" class="header-anchor">#</a> Vscode 运⾏情况</h2> <p>vscode 也是基于 Electron 开发的，⽬前最新版本是基于 Electron 13.5.2 版本</p> <h3 id="vscode-的electron-版本和发布时间"><a href="#vscode-的electron-版本和发布时间" class="header-anchor">#</a> vscode 的Electron 版本和发布时间</h3> <table><thead><tr><th>vscode 版本electron 版本发布⽇期</th> <th>vscode 版本electron 版本发布⽇期</th> <th>vscode 版本electron 版本发布⽇期</th></tr></thead> <tbody><tr><td>1.27 2.0 2018.08</td> <td>1.27 2.0 2018.08</td> <td>1.27 2.0 2018.08</td></tr> <tr><td>1.36 4.0 2019.07</td> <td>1.36 4.0 2019.07</td> <td>1.36 4.0 2019.07</td></tr> <tr><td>1.40 6.0 2019.10</td> <td>1.40 6.0 2019.10</td> <td>1.40 6.0 2019.10</td></tr> <tr><td>1.43 7.0 2020.02</td> <td>1.43 7.0 2020.02</td> <td>1.43 7.0 2020.02</td></tr> <tr><td>1.49 9.0 2020.08</td> <td>1.49 9.0 2020.08</td> <td>1.49 9.0 2020.08</td></tr></tbody></table> <p>简单做了 Electron 9.2.1 的运⾏测试
windows7 + .net framework 4.5.2 测试结果：⿊屏，且GPU渲染进程持续崩溃
<img src="/yuque/0/2021/png/139763/1637048201279-3212db82-6188-4924-8d79-99127bff831c.png" alt="image.png"> <img src="/yuque/0/2021/png/139763/1637048209491-14b43edb-9861-43ee-a809-fb9575a01453.png" alt="image.png"> <img src="/yuque/0/2021/png/139763/1637048218314-c3210e18-695d-4257-b0fa-a476a73b974f.png" alt="image.png">
通过进程监视器可以很清楚看到，反复崩溃⼜重新唤起的时⼀个 gpu 渲染进程，这就是 Electron 能启
动，但是窗⼝时⿊⾊端原因
vscode 从 1.40 版本开始使⽤了⾼于 Electron6 以上的版本，后续 有⼈提出了相关的 issue， 从此之
后，vscdoe 官⽹开始贴出如下这样⼀段系统环境要求。（⽽以前只是简单的写 windows7,8,10）
但是实测，安装了 .net framework 4.5.2（其他 .net 版本的也都测试过了） 仍然是⿊屏，看到GPU渲染
进程⼀直在崩溃（vscode 1.50 和 Electron 9.2.1 官⽅包都是）</p> <h2 id="electron-9-2-1-在-win7-成功运行方法"><a href="#electron-9-2-1-在-win7-成功运行方法" class="header-anchor">#</a> Electron 9.2.1 在 win7 成功运⾏⽅法</h2> <p>在对⽐ Vscode 和 Electron 版本的时候，⽂件有⼩⽐例的⼤⼩差异是可以忽略的，因为 windows 签名
会略增⼤⽂件尺⼨，但是发现⾥⾯的 d3dcompiler_47.dll 这个⽂件的差异尤其⼤。
<img src="/yuque/0/2021/png/139763/1637048255088-ee4e3642-d343-4b61-8fe3-bfb786d908ec.png" alt="image.png">
尝试把 Electron5.0 版本⾥的 d3dcompiler_47.dll 覆盖到 Electron 9.2.1 , 发现可以正常运⾏，并且进
程监视器中不再看到 GPU 进程崩溃现象
<img src="/yuque/0/2021/png/139763/1637048283363-2ee9a932-edce-47cf-a024-b68836935c62.png" alt="image.png">
但是在 vscode ⾥把 electron 5.0 的 d3dcompiler.dll 直接替换掉这个⽂件不⾏，现象仍然时反复崩溃
<img src="/yuque/0/2021/png/139763/1637048299233-51a059fc-732d-4a8a-9ee4-a7802f0d3f2c.png" alt="image.png">
猜测是跟版本签名有关系导致 vscode 1.50 不认拷⻉进去 d3dcompiler ⽂件，于是我在⾃⼰的机器上同
时安装了两个版本的 vscode 1.50 (electron9.2.1) 和 1.27(electron 2.0.7)，两个分别运⾏，前者⿊屏，
后者能正常运⾏（证明安装过程中vscode并没有给系统附加什么注册⽂件之类端影响到运⾏效果）。
然后把后者⽂件夹下的 d3dcompiler.dll ⽂件复制替换到 1.50 的版本⾥，发现 1.50 版本也能正常运⾏
了
<img src="/yuque/0/2021/png/139763/1637048317875-3ca889fa-d75b-49bb-aaf7-c7ac1fd758b2.png" alt="image.png">
回过来查了 Electron 的相关 issue，发现有类似的说法：
https://github.com/electron/electron/issues/24434，概括⼀下起来是两个处理办法：</p> <ul><li>chrome 83 版本中的 d3dcompile  ⽂件替换到Electron根⽬录</li> <li>在 node 端使⽤这个 api 禁⽤掉 GPU 渲染加速 app.commandLine.appendSwitch('disablegpu')</li></ul> <h2 id="⻜书-最新版-3-32-3-3-32-3-399"><a href="#⻜书-最新版-3-32-3-3-32-3-399" class="header-anchor">#</a> ⻜书(最新版 3.32.3 (3.32.3.399))</h2> <p>⻜书也是基于 Electron 构建的桌⾯应⽤，包含 Mac + Windows 双端
在 win7(⾮sp1、⽆.net framework) 下可以正常运⾏，检查发现 Electron 版本是 5.0.0。
（mac 和 windows 都是 electron 5.0.0）</p> <ul><li>windows 版本</li></ul> <p><img src="/yuque/0/2021/png/139763/1637048389420-248dedf5-e399-4dd0-b30a-8bf90b8f0a6a.png" alt="image.png"></p> <ul><li>mac 版本</li></ul> <p><img src="/yuque/0/2021/png/139763/1637048406561-5e85c8ad-e8b3-4087-87ee-dc03fc4d501c.png" alt="image.png"></p> <h2 id="关于-d3dcompiler-dll"><a href="#关于-d3dcompiler-dll" class="header-anchor">#</a> 关于 d3dcompiler.dll</h2> <p>查阅相关的资料了解到这个⽂件是⽤于画⾯渲染的，⼀般中视频、游戏等与 GPU 加速相关的场景下使
⽤。
⽽win7 到 win7 sp1 的⼀个变化就是 DirectX 版本的差异，(从 DirectX 10 升级到 DirectX 11）</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <ul><li>⽬前官⽅ Electron6.0 以上是不⽀持 windows7 的，最低也需要 windows7 sp1 + .net framework 的环境</li> <li>Windows7 运⾏ 9.3.2 的 Electron 是有可能的
<ul><li>通过替换 d3dcompiler_47.dll ⽂件解决</li> <li>通过 Electron 端启动的时候加禁⽤ GPU 加速解决，另外正在想办法 debug 或者看⽇志，找找 d3dcompiler 加载失败的原因，更有针对性解决问题。</li></ul></li></ul> <p>有新的发现会持续更新本⽂</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pr/electron/electron-overview.html" class="prev">
        Electron 经验
      </a></span> <span class="next"><a href="/pr/electron/xl1.html">
        扒一扒某下载软件的源码
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ae098b94.js" defer></script><script src="/assets/js/2.846b7fc6.js" defer></script><script src="/assets/js/1.bc703a74.js" defer></script><script src="/assets/js/31.0442f702.js" defer></script>
  </body>
</html>
