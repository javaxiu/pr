<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>双滚动条的滚动逻辑 | xiujava</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="jiawen 的博客">
    
    <link rel="preload" href="/pr/assets/css/0.styles.3978be1e.css" as="style"><link rel="preload" href="/pr/assets/js/app.b652a85f.js" as="script"><link rel="preload" href="/pr/assets/js/2.846b7fc6.js" as="script"><link rel="preload" href="/pr/assets/js/1.bc703a74.js" as="script"><link rel="preload" href="/pr/assets/js/47.bbf6f3b2.js" as="script"><link rel="prefetch" href="/pr/assets/js/10.afb24a76.js"><link rel="prefetch" href="/pr/assets/js/11.26a4e38a.js"><link rel="prefetch" href="/pr/assets/js/12.972428b2.js"><link rel="prefetch" href="/pr/assets/js/13.363a2818.js"><link rel="prefetch" href="/pr/assets/js/14.da87bb03.js"><link rel="prefetch" href="/pr/assets/js/15.be6c279e.js"><link rel="prefetch" href="/pr/assets/js/16.5b27973e.js"><link rel="prefetch" href="/pr/assets/js/17.e9441626.js"><link rel="prefetch" href="/pr/assets/js/18.73cc4e61.js"><link rel="prefetch" href="/pr/assets/js/19.04ead57f.js"><link rel="prefetch" href="/pr/assets/js/20.a59fc3ba.js"><link rel="prefetch" href="/pr/assets/js/21.08fe35aa.js"><link rel="prefetch" href="/pr/assets/js/22.f5ce9d9e.js"><link rel="prefetch" href="/pr/assets/js/23.47ca722c.js"><link rel="prefetch" href="/pr/assets/js/24.4fddcd23.js"><link rel="prefetch" href="/pr/assets/js/25.633c1faa.js"><link rel="prefetch" href="/pr/assets/js/26.8ab83674.js"><link rel="prefetch" href="/pr/assets/js/27.182bd1ad.js"><link rel="prefetch" href="/pr/assets/js/28.1383b35a.js"><link rel="prefetch" href="/pr/assets/js/29.ae522b2f.js"><link rel="prefetch" href="/pr/assets/js/3.7d9825a9.js"><link rel="prefetch" href="/pr/assets/js/30.bcb96b1e.js"><link rel="prefetch" href="/pr/assets/js/31.dc8342be.js"><link rel="prefetch" href="/pr/assets/js/32.1dc6f5da.js"><link rel="prefetch" href="/pr/assets/js/33.c22b5273.js"><link rel="prefetch" href="/pr/assets/js/34.8897cec6.js"><link rel="prefetch" href="/pr/assets/js/35.5dcb8c21.js"><link rel="prefetch" href="/pr/assets/js/36.11dde236.js"><link rel="prefetch" href="/pr/assets/js/37.fbdf6108.js"><link rel="prefetch" href="/pr/assets/js/38.6c386453.js"><link rel="prefetch" href="/pr/assets/js/39.bbbe93e7.js"><link rel="prefetch" href="/pr/assets/js/4.1b5a2940.js"><link rel="prefetch" href="/pr/assets/js/40.fa8a4a55.js"><link rel="prefetch" href="/pr/assets/js/41.1337de57.js"><link rel="prefetch" href="/pr/assets/js/42.974b0c08.js"><link rel="prefetch" href="/pr/assets/js/43.5ec06833.js"><link rel="prefetch" href="/pr/assets/js/44.41d4f968.js"><link rel="prefetch" href="/pr/assets/js/45.74b1a5a1.js"><link rel="prefetch" href="/pr/assets/js/46.0b447bda.js"><link rel="prefetch" href="/pr/assets/js/48.4e4341c7.js"><link rel="prefetch" href="/pr/assets/js/49.b676e821.js"><link rel="prefetch" href="/pr/assets/js/5.0d0d8c0c.js"><link rel="prefetch" href="/pr/assets/js/50.89ce29be.js"><link rel="prefetch" href="/pr/assets/js/51.5d694e00.js"><link rel="prefetch" href="/pr/assets/js/52.9da5a600.js"><link rel="prefetch" href="/pr/assets/js/53.3a609c95.js"><link rel="prefetch" href="/pr/assets/js/54.c2aa27ca.js"><link rel="prefetch" href="/pr/assets/js/55.7e92886a.js"><link rel="prefetch" href="/pr/assets/js/56.b2bd260a.js"><link rel="prefetch" href="/pr/assets/js/57.bc7fc028.js"><link rel="prefetch" href="/pr/assets/js/58.0b9ba301.js"><link rel="prefetch" href="/pr/assets/js/59.30303c2b.js"><link rel="prefetch" href="/pr/assets/js/6.ec95ead8.js"><link rel="prefetch" href="/pr/assets/js/60.05f954c6.js"><link rel="prefetch" href="/pr/assets/js/7.aa392645.js"><link rel="prefetch" href="/pr/assets/js/vendors~docsearch.5e19b665.js">
    <link rel="stylesheet" href="/pr/assets/css/0.styles.3978be1e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/pr/" class="home-link router-link-active"><!----> <span class="site-name">xiujava</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/pr/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://www.yuque.com/xiwen-bxuha/pr/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  yuque
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/javaxiu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/pr/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://www.yuque.com/xiwen-bxuha/pr/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  yuque
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/javaxiu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NLP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Electron系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>低代码系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>技术分享</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pr/pr/tech/scroll-bar.html" aria-current="page" class="active sidebar-link">双滚动条的滚动逻辑</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pr/pr/tech/scroll-bar.html#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/pr/pr/tech/scroll-bar.html#尝试" class="sidebar-link">尝试</a></li><li class="sidebar-sub-header"><a href="/pr/pr/tech/scroll-bar.html#解决" class="sidebar-link">解决</a></li><li class="sidebar-sub-header"><a href="/pr/pr/tech/scroll-bar.html#后话" class="sidebar-link">后话</a></li></ul></li><li><a href="/pr/pr/tech/figma_dev_mode.html" class="sidebar-link">figma devmode</a></li><li><a href="/pr/pr/tech/figma_2_code.html" class="sidebar-link">figma导出代码</a></li><li><a href="/pr/pr/tech/ts-trick.html" class="sidebar-link">TS抽取组件描述</a></li><li><a href="/pr/pr/tech/typescript.html" class="sidebar-link">typescript 巧技</a></li><li><a href="/pr/pr/tech/api-loader.html" class="sidebar-link">low-code 模式下的数据接入方案</a></li><li><a href="/pr/pr/tech/google_workspace.html" class="sidebar-link">Google Workspace add-ons</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>杂谈</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="双滚动条的滚动逻辑"><a href="#双滚动条的滚动逻辑" class="header-anchor">#</a> 双滚动条的滚动逻辑</h1> <blockquote><p>今日段子（改编自日常工作，请认真地对号入座）
产品经理：我要做个手机壳颜色跟着衣服颜色变。什么？做不到？你旁边那个前端他说可以，你跟他请教一下，下班之前上线！
旁边的前端：你可以参考一下变色龙，你把皮贴到手机壳上，技术上可以的。
我：哈？excuse me? 你是个大聪(s)明(b)吗?
旁边的前端告诉产品经理：我跟他说了方案了，他有点自以为是不想听而已
产品经理：他主管在哪，我投诉一下</p></blockquote> <h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <p>先看类似这样一个页面 <a href="https://lightrun.com/answers/cardano-foundation-developer-portal-nodejs-and-yarn-version-" target="_blank" rel="noopener noreferrer">https://lightrun.com/answers/cardano-foundation-developer-portal-nodejs-and-yarn-version-<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，内容不重要，就中间的那个带滚动条的区域（没出现滚动的把窗口宽度拉小一点）
<img src="/pr//yuque/0/2023/png/139763/1694594439097-ef9e678e-79d5-4755-a2ff-d922557b616e.png" alt="image.png">
如果你是用 mac 电脑的触摸板，鼠标指针悬停在滚动 div 区域，双指不要离开触摸板，一直往上推，它是不是到底了之后，整个网页不会往上滚动了？需要手指从触摸板离开一次，（鼠标指针不用换位置）再接着往上推，整个网页又可以往上滚动了</p> <p>如果你是用鼠标（windows/mac都可以），鼠标指针悬停在 div 区域，滚动滚珠，一直滚动，它到底部之后，整个网页不会往上滚动了，需要停止滚��� 2 秒钟（鼠标指针不用移动位置，也不用做点击之类的其他操作）再接着往上滚动滚珠，整个网页又可以往上滚动了</p> <p>产品经理认为是 bug，预期是能滚动完子区域之后接着滚动 page，不用做「离开触摸板/滚珠停止2秒」这样的操作，即可顺畅往下滑动
（Mac人机交互设计师：来，我位置给你做）</p> <h2 id="尝试"><a href="#尝试" class="header-anchor">#</a> 尝试</h2> <p>这个问题的第一反应是这个 css 配置 overscroll-behavior: contain，但是这个是表达触底之后是否触发父级，它的3个参数 auto、contain、none，显然都不能控制这一行为，最接近需求的 auto 本身就是默认值，一般页面都默认是这个，它并不管延迟的问题。
触底之后禁止滚动、禁止鼠标事件、让元素失焦、让别的元素获得焦点，都尝试过了，不出意料都不管用。不过这步操作发现了一个意外的效果：即便代码已经给它设置为禁止滚动、无鼠标事件了，如果「未离开触摸板 or 鼠标滚珠未停下超过2秒钟」，此 div 仍然可以滚动，且能触发 wheel/scroll 事件。即便我设置了 captrue 和 passive 参数。这至少说明一个问题：滚动操作，有个截止标志。（这里推测是浏览器为了类似滚轮惯性做持续监听，所以需要个标志）
这就能解释通了：这个截止标志，对于触摸板而言是手指头离开触模板，对于鼠标滚珠而言是你停止滚动滚珠一段时间（大概2秒）。所以这™的是系统行为，而且至少是操作系统内核级别的行为，那在浏览器里的 js 基本就无解了。
基于这个判断，尝试了 Safari、Firefox、Edge，无一例外都是这一效果，更证实了这就是内核级 feature。好嘛，经典的 feature 当 bug 修了，而且是内核级的。
<img src="/pr//yuque/0/2023/png/139763/1694595107821-63974e95-cdad-4064-9307-e01b17564b72.png" alt="image.png"></p> <h2 id="解决"><a href="#解决" class="header-anchor">#</a> 解决</h2> <p>实在要解决，那就做点障眼法来绕开这个内核 feature 吧。能想到的解决办法就是委派事件，模拟滚动，也就是滚动到头了之后，继续把滚动事件派发到上一层滚动容器去。onscroll 到底部之后事件不会接着给回调了，那就只能用 onwheel ，做一个触底判断。代码也很简单
<img src="/pr//yuque/0/2023/png/139763/1694602661336-0377c8b2-9cac-42ab-8b40-a51b31c3a079.png" alt="image.png">
实际操作解决了问题，但是发现两个新问题：</p> <ol><li>Mac 触模板的 deltaY 有点偏大，大概是快了3倍的样子，稍作除法即可</li> <li>滚珠的 deltaY 大得夸张，似乎是有滚动惯性，也就是你快速滚动三五次「咔哒」声滚珠，它能给你一个 260px 的 deltaY，离谱。此处可以借助自然对数，做了一个平缓处理</li></ol> <p>那么如何区分滚动行为是滚珠还是双指滚动呢？找了一下果然还是有办法 <a href="https://stackoverflow.com/questions/10744645/detect-touchpad-vs-mouse-in-javascript/62415754#62415754" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/10744645/detect-touchpad-vs-mouse-in-javascript/62415754#62415754<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <img src="/pr//yuque/0/2023/png/139763/1694598244219-44498f8b-0ab7-4b20-8f3e-22dea56a6782.png" alt="image.png"><img src="/pr//yuque/0/2023/png/139763/1694598286986-21dda197-c0e0-44ea-997d-f9ad9993ccd3.png" alt="image.png"></p> <p>另外，看了一下滚珠数值离谱的问题，尝试了 mdn 上的这个 demo，看代码也是直接使用 deltaY，可以看到，如果快速「咔哒」滚动滚珠，它的矩形尺寸变化也是很离谱的 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/wheel_event" target="_blank" rel="noopener noreferrer">https://developer.mozilla.org/en-US/docs/Web/API/Element/wheel_event<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>最终代码
<img src="/pr//yuque/0/2023/png/139763/1694602977745-1d53da56-297f-4e9d-b1cf-5a9b2d4bfb4b.png" alt="image.png"></p> <h2 id="后话"><a href="#后话" class="header-anchor">#</a> 后话</h2> <ol><li>Mac 的触模板体验确实比鼠标做得好，从开发者的角度看</li> <li>看了看，也有人提出跟我们一样的问题, 也有人回答了，这是一个防止用户产生迷惑的 feature。<a href="https://stackoverflow.com/questions/56008625/scroll-delay-between-two-divs-issue" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/56008625/scroll-delay-between-two-divs-issue<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>产品跟旁边的前端说，你看，我就说能做，他说不能，都是你指导得好，下次还要多指导一下这种低能的前端码仔。旁边的前端：好的</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pr/pr/lc/create-iframe.html" class="prev">
        细节 - 如何创建 iframe
      </a></span> <span class="next"><a href="/pr/pr/tech/figma_dev_mode.html">
        figma devmode
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/pr/assets/js/app.b652a85f.js" defer></script><script src="/pr/assets/js/2.846b7fc6.js" defer></script><script src="/pr/assets/js/1.bc703a74.js" defer></script><script src="/pr/assets/js/47.bbf6f3b2.js" defer></script>
  </body>
</html>
