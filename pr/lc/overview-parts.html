<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>概念 - 编辑器核心框架 | xiujava</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="jiawen 的博客">
    
    <link rel="preload" href="/pr/assets/css/0.styles.3978be1e.css" as="style"><link rel="preload" href="/pr/assets/js/app.b34ec94f.js" as="script"><link rel="preload" href="/pr/assets/js/2.846b7fc6.js" as="script"><link rel="preload" href="/pr/assets/js/1.bc703a74.js" as="script"><link rel="preload" href="/pr/assets/js/39.df46d84f.js" as="script"><link rel="prefetch" href="/pr/assets/js/10.afb24a76.js"><link rel="prefetch" href="/pr/assets/js/11.26a4e38a.js"><link rel="prefetch" href="/pr/assets/js/12.972428b2.js"><link rel="prefetch" href="/pr/assets/js/13.363a2818.js"><link rel="prefetch" href="/pr/assets/js/14.da87bb03.js"><link rel="prefetch" href="/pr/assets/js/15.be6c279e.js"><link rel="prefetch" href="/pr/assets/js/16.5b27973e.js"><link rel="prefetch" href="/pr/assets/js/17.e9441626.js"><link rel="prefetch" href="/pr/assets/js/18.73cc4e61.js"><link rel="prefetch" href="/pr/assets/js/19.04ead57f.js"><link rel="prefetch" href="/pr/assets/js/20.a59fc3ba.js"><link rel="prefetch" href="/pr/assets/js/21.08fe35aa.js"><link rel="prefetch" href="/pr/assets/js/22.8cb9dc27.js"><link rel="prefetch" href="/pr/assets/js/23.68778ed8.js"><link rel="prefetch" href="/pr/assets/js/24.f951cc52.js"><link rel="prefetch" href="/pr/assets/js/25.bb9d1655.js"><link rel="prefetch" href="/pr/assets/js/26.23b3f76a.js"><link rel="prefetch" href="/pr/assets/js/27.190cfa57.js"><link rel="prefetch" href="/pr/assets/js/28.3e339daa.js"><link rel="prefetch" href="/pr/assets/js/29.4eb1db41.js"><link rel="prefetch" href="/pr/assets/js/3.7d9825a9.js"><link rel="prefetch" href="/pr/assets/js/30.adc68930.js"><link rel="prefetch" href="/pr/assets/js/31.7ec8bb17.js"><link rel="prefetch" href="/pr/assets/js/32.47391ccd.js"><link rel="prefetch" href="/pr/assets/js/33.ebf9af3c.js"><link rel="prefetch" href="/pr/assets/js/34.8670c25e.js"><link rel="prefetch" href="/pr/assets/js/35.8246591f.js"><link rel="prefetch" href="/pr/assets/js/36.9794f5bd.js"><link rel="prefetch" href="/pr/assets/js/37.c8fc108f.js"><link rel="prefetch" href="/pr/assets/js/38.35e310b5.js"><link rel="prefetch" href="/pr/assets/js/4.1b5a2940.js"><link rel="prefetch" href="/pr/assets/js/40.4cb44a86.js"><link rel="prefetch" href="/pr/assets/js/41.165c4d4d.js"><link rel="prefetch" href="/pr/assets/js/42.6cfaf2ba.js"><link rel="prefetch" href="/pr/assets/js/43.436765f6.js"><link rel="prefetch" href="/pr/assets/js/44.1d1d3e9b.js"><link rel="prefetch" href="/pr/assets/js/45.0bccaafe.js"><link rel="prefetch" href="/pr/assets/js/46.b42902a6.js"><link rel="prefetch" href="/pr/assets/js/47.300d1ad2.js"><link rel="prefetch" href="/pr/assets/js/48.5015b80e.js"><link rel="prefetch" href="/pr/assets/js/49.4dec6231.js"><link rel="prefetch" href="/pr/assets/js/5.0d0d8c0c.js"><link rel="prefetch" href="/pr/assets/js/50.2267cf64.js"><link rel="prefetch" href="/pr/assets/js/51.7bdd1e94.js"><link rel="prefetch" href="/pr/assets/js/52.9da5a600.js"><link rel="prefetch" href="/pr/assets/js/53.089a5dc4.js"><link rel="prefetch" href="/pr/assets/js/54.34970eb3.js"><link rel="prefetch" href="/pr/assets/js/55.6e970c0f.js"><link rel="prefetch" href="/pr/assets/js/56.fe35ec84.js"><link rel="prefetch" href="/pr/assets/js/57.00921405.js"><link rel="prefetch" href="/pr/assets/js/58.0b9ba301.js"><link rel="prefetch" href="/pr/assets/js/59.1a42c7c8.js"><link rel="prefetch" href="/pr/assets/js/6.ec95ead8.js"><link rel="prefetch" href="/pr/assets/js/60.0523783a.js"><link rel="prefetch" href="/pr/assets/js/7.aa392645.js"><link rel="prefetch" href="/pr/assets/js/vendors~docsearch.5e19b665.js">
    <link rel="stylesheet" href="/pr/assets/css/0.styles.3978be1e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/pr/" class="home-link router-link-active"><!----> <span class="site-name">xiujava</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/pr/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://www.yuque.com/xiwen-bxuha/pr/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  yuque
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/javaxiu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/pr/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://www.yuque.com/xiwen-bxuha/pr/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  yuque
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/javaxiu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NLP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Electron系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>低代码系列</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pr/pr/lc/platform.html" class="sidebar-link">生态 - 产品与平台生态</a></li><li><a href="/pr/pr/lc/framer.html" class="sidebar-link">他山 - Framer</a></li><li><a href="/pr/pr/lc/tech-choice.html" class="sidebar-link">概念 - 选型设计与调研</a></li><li><a href="/pr/pr/lc/skill-point.html" class="sidebar-link">概念 - 技术难点</a></li><li><a href="/pr/pr/lc/material.html" class="sidebar-link">入料 - 物料类型</a></li><li><a href="/pr/pr/lc/material-args.html" class="sidebar-link">编排 - 变量参数</a></li><li><a href="/pr/pr/lc/material-node.html" class="sidebar-link">编排 - 比组件更小的子元素</a></li><li><a href="/pr/pr/lc/overview-parts.html" aria-current="page" class="active sidebar-link">概念 - 编辑器核心框架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pr/pr/lc/overview-parts.html#核心框架" class="sidebar-link">核心框架</a></li><li class="sidebar-sub-header"><a href="/pr/pr/lc/overview-parts.html#扩展" class="sidebar-link">扩展</a></li></ul></li><li><a href="/pr/pr/lc/create-iframe.html" class="sidebar-link">细节 - 如何创建 iframe</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术分享</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>杂谈</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="概念-编辑器核心框架"><a href="#概念-编辑器核心框架" class="header-anchor">#</a> 概念 - 编辑器核心框架</h1> <blockquote><p>参考 lowcode-engine 的架构图 <a href="https://lowcode-engine.cn/docV2/ud2pdf" target="_blank" rel="noopener noreferrer">https://lowcode-engine.cn/docV2/ud2pdf<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，基本结构是经过业务考验的</p></blockquote> <h2 id="核心框架"><a href="#核心框架" class="header-anchor">#</a> 核心框架</h2> <p>可视化编辑器的核心，可以理解为一个流水线模板，它管理物料的导入（lowcode-engine叫入料）、可视化编辑（编排）、解析效果展示（渲染）、生成产物（出码）。
这是我理解的一个完整的可视化编辑器分层结构图，是从详细的实现角度分析的，实际上也分别对应了入料、编排、渲染、出码 4 个环节
<img src="/yuque/0/2022/jpeg/139763/1659679471196-2e02ee30-09c8-429b-af9f-d7155cceb39b.jpeg" alt=""></p> <h2 id="扩展"><a href="#扩展" class="header-anchor">#</a> 扩展</h2> <p>可视化编辑器本质上是一种「入料-编排-渲染-出码 」这样的软件工程模式(pattern)，或者可以叫做框架（skeleton），在不同使用场景可以给每个环节赋予不同的实现，进而实现不同的工程目的。可视化编辑器的核心也应该是轻量级的，由丰富的扩展来实现此流程，扩展包含物料、设置器、插件，物料对应入料和渲染环节，设置器对应编排环节，插件则可以嵌入到整个声明周期的任意环节。
思路和工作流程上 webpack 工作方式其实非常类似：
webpack:  代码 -&gt; loader -&gt;  plugin -&gt; 生成代码。  (plugin贯穿整个生命周期，这里只是线性)
可视化编辑:   组件  -&gt; 画布  -&gt; plugin  -&gt; 生成代码。(plugin同样贯穿声明周期）</p> <h3 id="物料"><a href="#物料" class="header-anchor">#</a> 物料</h3> <p>这篇讲得比较详细，大致分为基础组件、复合型组件。是否基础不在于代码体积和复杂度，在于是否是最小组成成分，比如文本展示、图像、对话框、表格等。一个好的物料体系，应该与日常工作写的 React 组件是同等级的，不应该引入过多概念。只管入参（props）和渲染（render）。
如果一定需要日常开发的 React 组件有什么不同，那就是编辑态和渲染态，你可能想要做一些不同的事情。
<a href="https://www.yuque.com/xiwen-bxuha/pr/dl00ay?view=doc_embed" target="_blank" rel="noopener noreferrer">物料类型<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="设置器"><a href="#设置器" class="header-anchor">#</a> 设置器</h3> <p>用于为组件配置参数（props）的组件，应该接受当前值（value）、经过用户操作之后（onChange） 通知框架此卡片的新值变成了什么。因此它对外表现应该是一个受控的类似 FormField 的组件，最简单的实现可以是这样：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token function-variable function">StringSetter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>value<span class="token punctuation">,</span> onChange<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token punctuation">,</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span>e <span class="token operator">=&gt;</span> <span class="token function">onChange</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>根据业务需要，在某些情况下你可能会需要「瞻前顾后」，就像 Form 表单一样，要关注另外一个 Field 改变了，这里需要作何反应。Setter 也是，你可能会需要知道这张卡片的其他值、画布上其他卡片当前的状态、以及触发其他卡片发生一些改变，这时候 Setter 的入参可以额外多一个 ctx ，用于获取这些你需要的信息。</p> <h3 id="插件"><a href="#插件" class="header-anchor">#</a> 插件</h3> <p>正如上文所说，一个框架的核心只包含核心流程，一些非必须行为应该以嵌入的方式，通过监听<strong>核心流程</strong>、<strong>调用框架 api</strong> 影响框架的数据和流程，从而拓展功能。比如历史记录撤销操作，这是大部分编辑器都具备的能力，但它并非核心流程必须步骤。这里抽取部分环节加以解释：
<img src="/yuque/__mermaid_v3/ebd275734074d286aa227785602d1a68.svg" alt="">从这个流程图可以看到，从 UI 到 编辑器核心，可以在很多地方提供 api ，api 大致分 3 种类型：</p> <ol><li>注入型，如 UI 注入，也就是事先注入一部分代码，框架才能正常（业务含义上的）初始化</li> <li>事件型-无副作用，只管监听某些关键事件，例如 Schema 的增删改动作。</li> <li>事件行-有副作用，更类似钩子，这里的设计跟 <a href="https://webpack.js.org/api/plugins/#tapable" target="_blank" rel="noopener noreferrer">webpack tapable<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 很类似，在关键位置提供同步或 PromiseLike 的钩子，插件监听这些钩子并修改此位置的值，返回给框架，框架拿到新值继续下一步</li></ol> <p>举例：</p> <ol><li>历史记录与撤销重做插件：监听 Schema.Update -&gt; 记录快照 -&gt; 监听键盘事件和撤销图标 -&gt; 使用Schema.reload api -&gt; 重设当前页面 schema</li> <li>限制某些字段不能为空：监听 Sync.Schema.Update -&gt; 判断是否是目标组件 -&gt; 判断 key 是否是目标 -&gt; 判断值是否空 -&gt; 返回默认值</li></ol> <h3 id="扩展包"><a href="#扩展包" class="header-anchor">#</a> 扩展包</h3> <p>通常在一个特定的业务领域，比如流程设计、运营、toB 中后台管理系统等，不同的业务领域有不同的界面样式、素材库的风格，这些反应在低代码编辑器上，就是将有关联的插件、物料、设置器的组合起来，因此基于这种需求会将一批特定领域的这 3 种代码放在一起（比如 npm 包) 作为一个领域扩展包，而不是每个单独各自管理。这样组合之后再进行部署的系统，可以理解为一个特定领域的租户。
<a href="https://www.yuque.com/xiwen-bxuha/pr/cchuly?inner=Nmtid&amp;view=doc_embed" target="_blank" rel="noopener noreferrer">从可视化编辑器到低代码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pr/pr/lc/material-node.html" class="prev">
        编排 - 比组件更小的子元素
      </a></span> <span class="next"><a href="/pr/pr/lc/create-iframe.html">
        细节 - 如何创建 iframe
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/pr/assets/js/app.b34ec94f.js" defer></script><script src="/pr/assets/js/2.846b7fc6.js" defer></script><script src="/pr/assets/js/1.bc703a74.js" defer></script><script src="/pr/assets/js/39.df46d84f.js" defer></script>
  </body>
</html>
